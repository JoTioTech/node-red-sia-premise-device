<!--
	Copyright (c) since the year 2016 Klaus Landsdorf (http://plus4nodered.com/)
	Copyright 2016 - Jason D. Harper, Argonne National Laboratory
	Copyright 2015,2016 - Mika Karaila, Valmet Automation Inc.
	All rights reserved.
	node-red-contrib-modbus

	@author <a href="mailto:klaus.landsdorf@bianco-royal.de">Klaus Landsdorf</a> (Bianco Royal)
-->
<script type="text/javascript">
	RED.nodes.registerType('SIA-server', {
		category: 'config',
		defaults: {

			name: { value: "" },
			receiverHost: { value: "", required: true },
			receiverPort: { value: "", required: true },
			receiverNumber : { value: ""},
			encryptionKey: { value: ""},
		},
		label: function () {
			return this.name || 'sia-server@' + this.receiverHost;
		},

		oneditprepare: function () {
			let previous = null;


			if(this.encryptionKey == null){
				this.encryptionKey = "";
			}

			let allowedLengths = [0, 32, 48, 64];
			if(!allowedLengths.includes(this.encryptionKey.length)){
				Node.error('Encryption key must be empty or 128, 192, 256 bits long in HEX');
			}

			if(!/^[0-9A-Fa-f]+$/.test(this.encryptionKey)){ // hexadecimal characters only
				Node.error('Encryption key must be in hexadecimal characters only (0-9, A-F)');
			}



			// check if encryptionKey is 128 bit 192 or 256 bit long
			// encryptionKey needs to be a hex string



		}
	})
</script>

<script type="text/x-red" data-template-name="SIA-server">
	<div class="form-row">
				<label for="node-config-input-name"><i class="icon-tag"></i> Name</label>
				<input type="text" id="node-config-input-name" placeholder="Name">
		</div>
		<div class="form-row">
				<label for="node-config-input-receiverHost">Receiver IP</label>
				<input type="text" id="node-config-input-receiverHost" placeholder="Receiver Host">
		</div>
		<div class="form-row">
				<label for="node-config-input-receiverPort">Receiver Port</label>
				<input type="number" id="node-config-input-receiverPort" placeholder="Receiver Port">
		</div>
		<div class="form-row">
				<label for="node-config-input-receiverNumber">Receiver Number</label>
				<input type="number" id="node-config-input-receiverNumber" placeholder="Receiver Number">
		</div>
		<div class="form-row">
				<label for="node-config-input-encryptionKey">Encryption Key</label>
				<input type="password" id="node-config-input-encryptionKey" placeholder="SIA Password">
		</div>
</script>

